# SetunaCloneAG 仕様書

## 1. プロジェクト概要
本プロジェクト「SetunaCloneAG」は、Windows用のスクリーンキャプチャツール「SETUNA2」のクローンアプリケーションです。Pythonを使用して開発され、画像の切り取り、デスクトップ上へのピン留め（最前面表示）、簡易編集などの機能を提供します。

## 2. 動作環境・開発環境
- **OS**: Windows 10/11
- **言語**: Python 3.x
- **GUIフレームワーク**: Tkinter (Python標準)

### 外部ライブラリ (Dependencies)
以下のPythonパッケージを使用しています。
- `Pillow`: 画像処理（キャプチャ、加工）
- `pynput`: グローバルホットキーの監視
- `pystray`: タスクトレイアイコンの制御
- `pyperclip`: クリップボード操作（冗長化のため一部使用、主にwin32clipboardを使用）
- `pywin32`: Windows APIへのアクセス（高機能なクリップボード操作など）

## 3. システム構成
アプリケーションは以下の4つの主要なモジュールで構成されています。

### 3.1. ファイル構成
- **`main.py`**: エントリーポイント。アプリケーションの初期化、タスクトレイアイコンの設定、グローバルホットキーのバインディングを行います。また、スニペット全体の管理（`SnippetManager`）も担当します。
- **`capture_tool.py`**: スクリーンキャプチャ機能を提供します。全画面の半透明オーバーレイを表示し、マウスドラッグによる領域選択を処理します。
- **`snippet_window.py`**: 切り取られた画像を表示する各ウィンドウ（スニペット）の実装です。移動、スケーリング、描画、コンテキストメニューなどの主要なUIロジックが含まれています。
- **`utils.py`**: 画面解像度の取得やウィンドウ位置の計算など、共通で使用されるユーティリティ関数を提供します。

### 3.2. クラス構成
- **`SetunaCloneApp` (`main.py`)**: アプリケーション本体。常駐プロセスとして動作し、キャプチャのリクエストをハンドリングします。
- **`TrayIcon` (`main.py`)**: タスクトレイアイコンの管理クラス。
- **`SnippetManager` (`main.py`)**: 生成された全てのスニペットウィンドウへの参照を保持し、一括操作（全て閉じる、マージするなど）を可能にします。
- **`CaptureTool` (`capture_tool.py`)**: キャプチャ画面（オーバーレイ）のクラス。
- **`SnippetWindow` (`snippet_window.py`)**: 個別の画像ウィンドウクラス。
- **`GroupWindow` (`snippet_window.py`)**: 複数のスニペットをタブ化したウィンドウクラス。
- **`SnippetLogicMixin` (`snippet_window.py`)**: `SnippetWindow` と `GroupWindow` で共有されるロジック（保存、コピーなど）を分離したMixinクラス。

## 4. 機能仕様

### 4.1. キャプチャ機能
- **トリガー**: `Ctrl + Shift + Z`（グローバルホットキー）
- **動作**: 画面全体をキャプチャし、半透明の黒色レイヤーで覆います。マウスドラッグで選択した矩形領域を新しいスニペットとして生成します。
- **キャンセル**: 右クリックでキャプチャモードを終了します。

### 4.2. スニペット表示機能
- **最前面表示**: 全てのスニペットは常に他のウィンドウより手前に表示されます。
- **フレームレス**: ＯＳ標準のタイトルバーを持たず、画像のみを表示します（視認性向上のため、白枠と影のエフェクトを付与）。
- **ドラッグ移動**: 画像上の任意の位置をドラッグして移動可能です。移動中は背景確認のため半透明になります。
- **シェーディング**: ダブルクリックでウィンドウを最小化（バー表示）し、邪魔にならないようにします。

### 4.3. 編集・操作機能
- **拡大縮小**: マウスホイールで表示倍率を変更可能。
- **不透明度調整**: コンテキストメニューからウィンドウの透過度を設定可能。
- **ペン描画**: 簡易的な赤色のペンでメモ書きが可能。
- **トリミング**: 表示されている画像の一部をさらに切り抜くことが可能。
- **アンドゥ**: 直前の描画やトリミング操作を取り消すことが可能（履歴保持）。

### 4.4. クリップボード連携
- 画像のコピー（`Ctrl + C`）およびカット（`Ctrl + X`）に対応し、他のアプリケーション（ペイント、Slack等）へ直接貼り付けが可能です。

### 4.5. グループ化
- 散らばった複数のスニペットを、タブ切り替え式の単一ウィンドウにまとめる機能を持ちます。

## 5. UI/UX デザイン指針
- **シンプルさ**: ユーザーが直感的に操作できるよう、UI要素は最小限に抑えています。
- **Setuna再現**: 元祖SETUNA2の使用感を可能な限り尊重し、ホットキーや挙動を模倣しています。
- **日本語対応**: UI、コメント、ドキュメントは全て日本語で提供されます。
